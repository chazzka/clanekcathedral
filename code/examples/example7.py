from mock.randomdatagenerator import *
import sys
import numpy as np
import random
from pathlib import Path

import matplotlib.pyplot as plt

from sklearn import preprocessing
from sklearn.neighbors import LocalOutlierFactor

from articletester.articletester import *

if __name__ == "__main__":

    trainData = [
        (76.25851703259706, 104.46008964375986),
        (94.97032327628267, 102.82945023770233),
        (76.46448444870597, 98.6908537197716),
        (113.81465542561278, 104.44990045950942),
        (133.83857960757496, 104.69945703476141),
        (80.02915633146195, 106.37962371055981),
        (72.9090780198711, 105.81224551300596),
        (114.02863886630563, 103.31358845834913),
        (78.74241821296528, 92.62231340627372),
        (55.688609283008425, 97.1169560094107),
        (115.32775156144712, 98.93154691521093),
        (58.40120235899546, 106.89870568325699),
        (142.62597702469907, 104.68305049381244),
        (128.2079329306448, 95.93564827636924),
        (81.03092397980978, 100.6764801238857),
        (101.17708628952741, 99.51542229190864),
        (120.70674452010091, 100.56759551138978),
        (98.81607161004416, 94.98193543693876),
        (53.3905322543714, 105.85871946297321),
        (93.3269331014779, 99.26512989958047),
        (99.67813041055427, 102.91348809217733),
        (69.68600001376437, 101.73305370758064),
        (111.63020506598696, 93.46537774934043),
        (86.14265205196773, 98.57445164300046),
        (97.09461207049341, 112.73043092940216),
        (71.64889471709782, 99.74469036375605),
        (103.90606766626016, 98.40260917165824),
        (117.7484555110443, 100.8254784645977),
        (61.74561678338013, 103.0894288637751),
        (134.96576077176576, 106.62981218531269),
        (132.02715427340917, 102.22121571108232),
        (92.13822716541637, 100.59681438832718),
        (146.6056963033849, 103.65386890657237),
        (51.274357553498504, 96.04980881990281),
        (102.0026974106616, 100.07807918517253),
        (148.76242119955032, 93.3581764936656),
        (133.1967969740474, 101.28306492547887),
        (146.95603192694665, 101.99750989703166),
        (61.80474443417386, 103.12527271134424),
        (146.75348411614135, 105.51646384710376),
        (114.3169571882383, 105.78675329711605),
        (121.22120159928502, 94.66547864226791),
        (74.7688273037986, 103.37550156336492),
        (128.1664071926832, 95.98273071917586),
        (146.3530332873355, 101.59063519668048),
        (136.5152628356876, 101.25071412926113),
        (57.838230244916566, 111.64669890851503),
        (65.06497476751099, 99.0832158704103),
        (116.46476010499887, 102.23370027681997),
        (101.94175014092457, 95.15466326778123),
        (56.0192334586335, 98.77548851728689),
        (96.85054578602663, 95.34928372962814),
        (133.8319372165708, 96.26994322317337),
        (147.2110270320958, 98.94414400734624),
        (134.46088675947993, 99.59830664429043),
        (96.81187259943655, 98.7198336028791),
        (89.17543419443301, 102.43136698008136),
        (118.03578863919716, 98.76353451938492),
        (78.54946547145988, 91.9418012040738),
        (135.81734266258013, 92.7470545702719),
        (78.1860734507113, 93.12971648342672),
        (63.38712146084718, 96.95267674608291),
        (99.54988133005017, 100.27533155219959),
        (55.73400820485842, 92.2393489296563),
        (56.896520061576474, 96.35147311798724),
        (129.4780032859312, 101.65014521767148),
        (70.79553847765321, 101.97588327786923),
        (131.10760189664342, 99.1109026688241),
        (95.79030920910039, 97.76116957272178),
        (52.095177444019505, 99.74734493740264),
        (56.34081480038085, 101.70050057185881),
        (80.90087207696287, 94.33459664835677),
        (50.51007147807331, 104.1000420844728),
        (82.06571019934397, 97.58170960179208),
        (99.70184199678289, 95.32185995818465),
        (77.08860957176418, 100.25177447585284),
        (50.24183761679705, 107.36784190408456),
        (103.9781817782243, 93.99178578213986),
        (75.45070003879836, 98.72159278110541),
        (140.08727254718536, 106.45747999354776),
        (130.4137249869129, 102.2787168645997),
        (78.61092933585763, 87.14071824768267),
        (87.88441240869675, 91.99875628425815),
        (112.34387563742368, 99.15946520433086),
        (62.88704333443829, 99.50222406277759),
        (50.69542092710129, 94.37449648834274),
        (134.52358554699296, 98.19381589965866),
        (51.483222861288404, 99.03989835297541),
        (104.11983066798132, 94.49549288604126),
        (85.07958932374703, 92.02480780922954),
        (56.25132919313896, 97.02263901798247),
        (96.37870956721548, 98.33684124184897),
        (135.27902832217393, 93.33281028839505),
        (117.73733819649445, 112.77719473325861),
        (111.5878420760356, 106.33369010535878),
        (130.70597240334985, 94.35262455184296),
        (134.59549672514692, 98.13632207415202),
        (140.38397157165127, 103.87824486960663),
        (54.3791352686833, 101.65748983951836),
        (75.15683676924388, 101.97660799678198),
        (2.27205515641546, 92.2660520423516),
        (33.361701154969566, 112.20123867961681),
        (1.884557246436076, 104.21837897570667),
        (3.499234158818587, 103.3170802483165),
        (4.372240424416978, 98.52652522427478),
        (22.879862812099198, 97.99176440376411),
        (20.134323413977548, 103.84031377299092),
        (11.341753980545807, 93.90279656170979),
        (10.883761221313533, 99.29232005155724),
        (17.42309650047977, 94.84220861125593),
        (23.881037391157545, 100.43230597370378),
        (18.082944817031542, 93.80114041926379),
        (21.463299714030857, 98.45145023206922),
        (34.2799397711807, 108.87578689800868),
        (22.82371465959948, 108.67846346369619),
        (36.932969977868765, 96.19407298243136),
        (30.24835355417433, 99.31602947628753),
        (5.2974275712111, 99.36345013978406),
        (39.29034558692376, 100.65532875793095),
        (4.585607238508302, 100.86026519119822),
        (20.923209600891163, 99.20898245286317),
        (31.871236793742632, 99.86315577992313),
        (10.21715720044757, 104.25288478979044),
        (28.429718747232343, 108.9415818794202),
        (36.682164339531035, 103.81776548444275),
        (33.17567517865192, 95.03038891891262),
        (22.258831660988395, 113.44721202325212),
        (3.5844821262894078, 107.33557504179969),
        (20.486348708209185, 101.81393228372211),
        (21.85249171495684, 100.63261301319852),
        (10.653452117017693, 100.32757030470148),
        (8.378179090281431, 100.49094864687308),
        (10.532984704847493, 95.53802302795987),
        (11.582001449834722, 110.23188288389528),
        (26.288135165376158, 107.36811648406565),
        (34.40447666663389, 94.47803888214804),
        (30.76284261406753, 95.65413207310907),
        (1.331992327125997, 96.13358654315725),
        (1.7794646663886615, 99.16900227475244),
        (38.57376952315553, 96.22524132292166),
        (22.766609967373945, 97.81670732192607),
        (36.996956770920534, 95.61976384789864),
        (25.271913923564178, 102.98430033443105),
        (18.41651230557812, 98.07724656844323),
        (17.949668192617693, 101.40412791122684),
        (29.055728816264764, 101.65722398670094),
        (32.91253042946712, 91.8801725553879),
        (15.59143221806378, 99.94023029794957),
        (12.900940346063123, 104.42174019310116),
        (11.193001103774098, 97.95620823686406),
        (3.8806609735198183, 98.00841415685461),
        (34.952122511843406, 97.99752220283105),
        (29.23564061213795, 91.87246382828587),
        (32.946328750619365, 106.18480209177623),
        (28.536624254652054, 97.67365778248822),
        (24.522538063600024, 93.06942983992849),
        (18.06773891392455, 95.30748202971058),
        (6.2844544644237255, 92.9398473226503),
        (22.955271095005454, 106.9005600187164),
        (9.781679072331757, 102.7142431996035),
        (21.07821868711366, 104.54632666220375),
        (32.156399763035026, 97.93068234886621),
        (35.076961794381425, 98.3389428343025),
        (14.734252838371296, 93.49418693854892),
        (34.843261342210454, 101.89361471967574),
        (35.67445281942831, 97.01252508863475),
        (27.421838829660224, 97.16434019944796),
        (32.69000105149724, 96.55942933642113),
        (2.1382393947455958, 98.68645956505362),
        (28.51791042417688, 108.98816047884674),
        (19.17835604078447, 100.44350106890862),
        (17.176856008386604, 105.22039965273626),
        (7.789756776209482, 92.43946165818875),
        (11.929543685219567, 103.84910301680189),
        (29.277580651129504, 101.10327310339595),
        (1.9083795191079034, 99.08067444862378),
        (11.521804123827128, 96.65438777245814),
        (13.228884994368038, 100.9029494477477),
        (5.8257009609284305, 104.55449836990941),
        (18.487113983905044, 101.88096552822553),
        (6.127541511093262, 97.38877456787415),
        (33.004232765993834, 103.03949102332132),
        (37.694288773542574, 109.81819737196172),
        (19.483203420930145, 97.40428609294858),
        (2.964091651178684, 93.24873884836465),
        (26.109027345767302, 99.7652224965573),
        (5.4477235407725555, 93.2648391542322),
        (26.1420026128399, 91.13414528041278),
        (3.954092192903058, 95.9232400552963),
        (29.771794113328095, 102.28070127053644),
        (29.871969975059116, 98.91874713569315),
        (17.022053926859932, 92.78723556856083),
        (12.310238392552733, 92.9933975869624),
        (30.423860110943735, 103.828398639454),
        (34.48717614157659, 97.20358429475063),
        (27.26971145029719, 109.01146579153757),
        (18.851324933869055, 107.34583267798972),
        (7.387457265063202, 101.91401921941565),
        (37.482741232016316, 94.6492940961592),
        (2.524477763188142, 94.89808284736635),
    ]

    trainData = np.asarray(trainData)

    testData = [
        (68.05419491643804, 89.91148343538444),
        (129.48248275891228, 109.97046948747158),
        (108.86887033962708, 103.57415497384716),
        (99.80580341510776, 97.95225289939329),
        (153.65614322995657, 99.82911043838284),
        (83.70928858710899, 82.96123945060532),
        (87.12237123839586, 104.7427080513091),
        (154.7510181743543, 101.33923076624961),
        (82.29798878492062, 99.03708591654502),
        (118.75491854637833, 101.32097466053382),
        (75.35082291816147, 102.48679942192068),
        (141.0284217748827, 107.49550769404989),
        (71.39484320367505, 99.00766742395803),
        (168.82863024460949, 106.78845333435365),
        (135.257246619369, 99.47650353853649),
        (112.89898980748973, 92.75601920569623),
        (88.88245113026198, 104.42925689253585),
        (103.91756003896342, 93.04362610502862),
        (71.99886694171151, 113.02548727845216),
        (110.04083176494814, 104.44844462419853),
        (89.61355190610622, 104.41369639480493),
        (124.7250484022647, 99.04147424907568),
        (161.31158717074825, 99.62380247613424),
        (121.24407412382922, 98.90379119322402),
        (111.84290437658092, 108.40267562822892),
        (83.66049782578969, 106.65500800666227),
        (71.28948421494854, 101.83814769790217),
        (143.53000490506184, 106.434865897127),
        (113.36135976002086, 98.99314596229354),
        (98.05914788278959, 104.89834218022678),
        (99.55156851945534, 93.80357188782355),
        (152.7523179097504, 100.69038307439182),
        (166.381473207271, 106.28771325842726),
        (64.18895612934139, 99.04723163542849),
        (84.45563170507941, 98.82721377540241),
        (148.79900026541378, 97.48722522041834),
        (91.9980207118104, 94.21785625582402),
        (99.07107096687935, 106.94002839548172),
        (81.1723947781936, 105.65676115850503),
        (74.75636935128993, 101.48091010580737),
        (154.27017653860474, 112.7167374667188),
        (136.40853506440732, 93.86791778526266),
        (71.81968228758149, 100.46908150845573),
        (156.13042320677377, 98.2937238696687),
        (111.15714125524568, 100.51676452526286),
        (62.12129695493343, 97.704047344266),
        (164.2790540716582, 104.02427761437303),
        (139.7181795566089, 100.70280659511641),
        (146.6963867554323, 107.40327369013318),
        (162.3160441580509, 98.69840995257472),
        (74.29347418346147, 95.06817066425914),
        (106.95753566661342, 98.38996263735824),
        (70.53595864474869, 96.90801886766411),
        (140.89537131449063, 94.12456030505187),
        (84.47863810657438, 105.98470225687849),
        (74.36885140358905, 103.87940578735186),
        (90.37428374051852, 101.06059876419354),
        (104.8714318076571, 100.37128557403564),
        (68.9463654088147, 98.08409388098194),
        (66.38601264834524, 100.4456269959929),
        (121.78088985819826, 96.89152838866835),
        (158.70737852195134, 95.84947242691199),
        (63.847162350075465, 111.15761107563169),
        (60.65162269863965, 94.30644909275156),
        (163.03923195108553, 97.02194640846122),
        (154.05884510061404, 108.48142574213722),
        (153.44568754885154, 107.69620917716482),
        (130.02418754345285, 94.7134225127952),
        (149.9693851054801, 109.72510063731633),
        (61.76212409930334, 111.33568501173139),
        (165.56981860468045, 96.39644497351865),
        (107.3327501750198, 108.74707028471491),
        (147.7551629140039, 111.31357145335875),
        (69.15768929260861, 96.09560592944054),
        (111.90247757354112, 93.45828139620035),
        (92.13305880541684, 102.29694285838795),
        (116.60925768105943, 99.61146742403535),
        (128.84571332368733, 108.39079307399493),
        (60.4590098533555, 99.43577990241143),
        (122.0359969689888, 110.1466169498697),
        (151.28931803205677, 104.08852895589543),
        (96.00764863133324, 105.67547263697634),
        (135.17720484962052, 103.13232436774291),
        (62.51709366854846, 99.44769909757457),
        (114.37954900983584, 102.31579664636709),
        (132.51888478501036, 95.20431965366525),
        (130.29442554453843, 81.41148976493042),
        (166.76190683515512, 102.7782415311142),
        (151.4050232484759, 105.04083050346868),
        (153.25403303090718, 101.1192035972846),
        (71.73945189385664, 101.45390803569224),
        (77.3510797145766, 94.91327640412688),
        (138.01349750283816, 104.9881868867989),
        (97.73661316823932, 95.91001582320486),
        (156.93643628485702, 93.89835961593735),
        (98.60773175484354, 101.73786652586732),
        (109.15196766216508, 99.07576156276708),
        (75.92083169416915, 89.92828522535822),
        (149.49916565464048, 106.56783884357486),
        (120.85270460209145, 98.8633579267664),
        (36.2181988109781, 101.2635876953761),
        (30.159210186593317, 96.5723128303734),
        (5.994498921157526, 96.33482267457644),
        (20.56950606232198, 108.35925959264134),
        (33.10693673471788, 92.7999611591106),
        (9.424898275608895, 100.89113857942685),
        (38.05657600077847, 101.8612353443965),
        (31.30475557557159, 104.10645814600385),
        (39.66380532599539, 107.0785942746284),
        (20.17140982449247, 97.71011388168678),
        (48.784066326452056, 97.28686363869538),
        (44.94638308671609, 100.16881151442577),
        (3.280371943070021, 101.5319942424128),
        (23.583423204594272, 106.13106540822986),
        (43.086082072682345, 91.88517956045918),
        (44.859068693277216, 103.71803331060514),
        (31.58075026958992, 100.42591202072288),
        (33.43869726849375, 89.26314953402378),
        (3.9365353012314808, 111.15358719928788),
        (6.087136198268422, 111.12076614361804),
        (48.861112446636135, 104.74460015436347),
        (4.852234531267941, 105.10599052778366),
        (32.87742391181237, 94.84255859756401),
        (39.69535325354088, 97.66658106038224),
        (9.10820854120753, 94.675866237378),
        (45.48865403478942, 95.90306047811437),
        (38.70525685306013, 93.68228985504823),
        (48.53404303992201, 94.45528257929105),
        (47.21260709814124, 90.3980656064545),
        (28.444731644624106, 91.92101149175494),
        (45.4719725990716, 101.22231853648356),
        (13.01843081116037, 97.40857157542604),
        (6.104372468377578, 99.62507404093391),
        (49.42171557358341, 94.50365349256232),
        (15.617983966232185, 97.27421239501435),
        (23.82525498723705, 103.54424236777531),
        (16.721566659799986, 104.2993606767944),
        (33.60953740997598, 105.18189496886023),
        (40.146448330214604, 98.40156622371957),
        (6.79794129490256, 93.52782956963894),
        (38.70635505511667, 83.65914706642522),
        (10.082303598409798, 105.33399950983778),
        (12.32718023613546, 96.95366504770072),
        (18.364329103546428, 99.79567661899375),
        (15.17452279762448, 100.70839986609342),
        (7.951372342108881, 106.27436179017523),
        (46.482159212344385, 95.99538265654552),
        (11.098929245596784, 98.42156598923263),
        (30.015501909386682, 106.73057717236682),
        (34.788543709410824, 103.33580914943451),
        (9.09914287783774, 100.11369122193558),
        (29.077936627669697, 97.69052072620694),
        (11.516573341102937, 103.51091171369686),
        (20.717617042375196, 95.90808805448518),
        (17.03919499558493, 103.54068364670134),
        (14.754639496737381, 93.45313782979527),
        (5.149060883815726, 98.27829146168882),
        (41.11991997539704, 92.55598441253416),
        (4.080025181786273, 104.11878806085394),
        (47.6642423013127, 100.74478445732214),
        (21.879970228894162, 100.62965938180453),
        (45.077551991237534, 88.18408620525494),
        (4.875152004248245, 99.76160482528736),
        (44.30017224721028, 94.08514265945544),
        (12.334435837818708, 99.5117373699343),
        (7.208856109898648, 92.73959078559916),
        (24.193426840424117, 94.83709795193404),
        (5.785172998256294, 103.55564037374029),
        (5.987638123368444, 90.14090436894514),
        (6.74698437689144, 104.48236171387687),
        (43.36196600364147, 97.67972420104107),
        (37.30045933925892, 107.57477462234836),
        (40.76986066900925, 102.5042804851215),
        (25.068866486671727, 91.09494199264486),
        (45.44313395538027, 109.35523688096124),
        (34.83566031752047, 89.22531943375357),
        (43.72614067042335, 100.51578658091186),
        (22.48704983654412, 97.45936508911025),
        (41.97971324552812, 110.31547793583879),
        (7.383535229645489, 97.62072323011974),
        (13.198237187719213, 106.56379520661483),
        (36.29456740767695, 101.6893024670068),
        (43.299693649550555, 97.6955915449442),
        (48.87462254056483, 98.11154815691634),
        (24.9375061089271, 98.1882244889977),
        (2.523705018964395, 96.46946527558454),
        (12.849797406152035, 111.0499264377028),
        (3.9428553858352533, 104.1303319012613),
        (10.946962401329435, 108.97147688253304),
        (44.66079970501927, 103.35870487185176),
        (27.11835377432829, 98.72750142914424),
        (36.304933753414936, 110.84494374353729),
        (40.41591109167092, 96.74435078758898),
        (41.46513056432307, 100.47112993894036),
        (36.67455030642309, 99.0880863003455),
        (9.813751641913647, 100.2248615875429),
        (9.999367580972063, 104.5016281349915),
        (37.10124700084062, 96.02096300939077),
        (8.446420006462569, 93.83346690921437),
        (11.410957263578176, 105.3522121536282),
    ]

    # noveltyData = list(generateRandomData([
    #     generateRandomClusters(centers=[(25, 200)], n_samples=10),
    # ]))

    noveltyData = [(32.0630583248332, 196.83988576208887), (25.15775197038327, 195.10816453666652), (16.906427209624237, 203.36496484615387), (21.621597400126774, 210.1909854328056), (11.108400557740834, 204.333802886511),
                   (34.64459548648327, 200.16016201558395), (22.335462294927705, 199.44216570895924), (41.12128162152527, 198.8342416843297), (25.13306934482792, 198.40395359908186), (29.626659574159234, 201.58826312961284)]

    all_data = np.asarray(trainData + testData)
    testData = np.asarray(noveltyData + testData)

    

    # novelty data + mesh
    # get minimum x
    min_x = min(list(map(lambda x: x[0], all_data)))
    max_x = max(list(map(lambda x: x[0], all_data)))
    
    min_y = min(list(map(lambda x: x[1], all_data)))
    max_y = max(list(map(lambda x: x[1], all_data)))
    

    clf = LocalOutlierFactor(novelty=True, n_neighbors=50).fit(trainData)
    predictedList = clf.predict(testData)

    regular = testData[predictedList == 1]

    outlier = testData[predictedList == -1]

    fi, ax = plotXYDataTwoClasses(regular, outlier, plt.subplots(), c=[
        'black', 'white'], labels=["Regular", "Outlier"], savepath=f"figures/{Path(__file__).stem}.svg")

    plt.show()

    print("done")
    sys.exit(0)
